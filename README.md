https://travis-ci.com/anisimovih/Message_sending_emulator.svg?branch=master

# Эмулятор отправки сообщений.

Программа реализует микросервис из [тестового задания](Test_task_discription.pdf), эмулирующий отправку сообщений в популярные мессенджеры(Viber, Telegram, WhatsApp). 

Для эмуляции реальной работы, на отправку однго сообщения выделяется случайное значение от 1 до 3 секунд.

## Используемые библиотеки.
Разработка производилась с использованием фреймворка Django. 
Ассинхронной обработкой сообщений заниманимается Celery.
Для сохранения результатов работы используется Redis.
Для валидации параметров используется JSON Schema.

## API.
### Описание.
REST API работает по протоколу HTTP и представляет собой набор методов, с помощью которых совершаются запросы и возвращаются ответы для каждой операции. Все ответы приходят в виде JSON структур.

### Рассылка сообщений.
Для рассылки сообщений отправляется POST запрос по ссылке:
http://127.0.0.1:8000/api/
Параметры запроса:

|    От одного до трех мессенджеров    | Список из объектов, содержащих параметры | |
| ------------- |:------------------| :-----|
| **Viber/Telegram/WhatsApp**       | Название мессенджера |(минимум - 1, максимум - все 3) |
|               | **user_id**    | ID пользователя (int) |
|               | **message**    | Сообщение пользователю(string) |
|               | **date_time***  |    Дата и время отправки(string в формате "YYYY-MM-DDThh:mm:ss±hh:mm") |

Пример запроса на отправку двух моментальных и 1 отложенного сообщения в два мессенджера:
```json
{
    "Telegram": [
        {
            "user_id": 1067000,
            "message": "message_1",
            "date_time": "2019-12-30T16:09:00+03:00"
        },
        {
            "user_id": 10670500,
            "message": "message_1"
        }
    ],
    "WhatsApp": [
        {
            "user_id": 10264904,
            "message": "message_1"
        }
    ]
}
```

В ответ приходит список, содержащий статусы добавления в очередь отправки каждого сообщения.
Возможные статусы:

* SUCCESS - сообщение добавлено в очередь отправки.
* PENDING - сообщение с таким текстом уже отправлялось данному пользователю.

Пример ответа: 
```json
{
    "005747a44cb1926a739ed3a1e427064a": "SUCCESS", 
    "d83dfa69d88637d249e9944a72409410": "FAILED",
    "415747a44b13426a787ki89k6y27064a": "SUCCESS"
}
```

### Поверка статуса сообщения.
Для проверки статуса сообщения отправляется GET запрос по ссылке:
http://127.0.0.1:8000/api/
Параметры запроса:

|   messages_id    |Список ID сообщений (string) |
| ------------- |:------------------|

Пример запроса на проверку статуса трех сообщений из двух мессенджеров:
```json
{
    "messages_id":[
        "a3783fd7d489033cc34f88ce01a6475e",
        "c88e46a5ffc11e1cc85de1713ffdef70"
    ]
}
```

В ответ приходит список, содержащий статус отвправки каждого сообщения.
Возможные статусы:
* SUCCESS - сообщение успешно отправлено.
* PENDING - сообщение еще не отправлено, или нет сообщения с таким id.

Пример ответа:
```json
{
    "a3783fd7d489033cc34f88ce01a6475e": "SUCCESS", 
    "c88e46a5ffc11e1cc85de1713ffdef70": "PENDING"
}
```

### Отмена отложенной отправки.
Для отмены отправки отложенного сообщения отправляется PUT запрос по ссылке:
http://127.0.0.1:8000/api/
Параметры запроса:

|   messages_id    |Список ID сообщений (string) |
| ------------- |:------------------|

Пример запроса на отмену отпрвки двух отложенных сообщений:
```json
{
    "message_id": [
        "a3783fd7d489033cc34f88ce01a6475ef",
        "b757df468bc0b4734d9a3c46e441eecb"
    ]
}
```
В ответ приходит список, содержащий результаты отмены каждого сообщения
Возможные статусы:
* SUCCESS - сообщение удалено из очереди отложенной отправки.
* FAIL - сообщение с таким id нет в очереди отложенной отправки.

Пример ответа: 
```json
{
    "a3783fd7d489033cc34f88ce01a6475ef": "SUCCESS", 
    "b757df468bc0b4734d9a3c46e441eecb": "FAIL"
}
```


















